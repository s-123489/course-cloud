server:
  port: 8090

spring:
  application:
    name: gateway-service  # API 网关服务名称

  cloud:
    nacos:
      discovery:
        enabled: true
        server-addr: nacos:8848  # Nacos 服务地址
        namespace: dev  # 命名空间
        register-enabled: true
        group: COURSEHUB_GROUP  # 分组
        ephemeral: true  # 临时实例
        heart-beat-interval: 5000  # 心跳间隔 5s
        heart-beat-timeout: 15000  # 心跳超时 15s

    gateway:
      # ==================== 路由配置 ====================
      routes:
        # User Service 路由 - 学生接口（精确匹配）
        - id: user-service-students-exact
          uri: lb://user-service
          predicates:
            - Path=/api/users/students
          filters:
            - RewritePath=/api/users/students, /api/students

        # User Service 路由 - 学生接口（子路径）
        - id: user-service-students
          uri: lb://user-service
          predicates:
            - Path=/api/users/students/**
          filters:
            - RewritePath=/api/users/students/(?<segment>.*), /api/students/$\{segment}

        # User Service 路由 - 教师接口（精确匹配）
        - id: user-service-teachers-exact
          uri: lb://user-service
          predicates:
            - Path=/api/users/teachers
          filters:
            - RewritePath=/api/users/teachers, /api/teachers

        # User Service 路由 - 教师接口（子路径）
        - id: user-service-teachers
          uri: lb://user-service
          predicates:
            - Path=/api/users/teachers/**
          filters:
            - RewritePath=/api/users/teachers/(?<segment>.*), /api/teachers/$\{segment}

        # User Service 路由 - 认证接口
        - id: user-service-auth
          uri: lb://user-service
          predicates:
            - Path=/api/auth/**
          filters:
            - RewritePath=/api/auth/(?<segment>.*), /auth/$\{segment}

        # User Service 路由 - 其他接口
        - id: user-service
          uri: lb://user-service
          predicates:
            - Path=/api/users/**
          filters:
            - RewritePath=/api/users, /api/students

        # Catalog Service 路由
        - id: catalog-service
          uri: lb://catalog-service
          predicates:
            - Path=/api/courses/**

        # Enrollment Service 路由
        - id: enrollment-service
          uri: lb://enrollment-service
          predicates:
            - Path=/api/enrollments/**

      # ==================== CORS 跨域配置 ====================
      globalcors:
        cors-configurations:
          '[/**]':
            allowedOriginPatterns: "*"  # 允许所有来源（生产环境建议指定具体域名）
            allowedMethods:
              - GET
              - POST
              - PUT
              - DELETE
              - OPTIONS
            allowedHeaders: "*"  # 允许所有请求头
            allowCredentials: true  # 允许携带凭证
            maxAge: 3600  # 预检请求缓存时间（秒）

# ==================== JWT 配置 ====================
jwt:
  secret: coursecloud-jwt-secret-key-for-authentication-minimum-256-bits-required-for-hs512-algorithm  # JWT 密钥（至少 256 位）
  expiration: 86400000  # Token 有效期（24 小时 = 24 * 60 * 60 * 1000 毫秒）

# ==================== 日志配置 ====================
logging:
  level:
    root: INFO
    com.zjgsu.syt.coursecloud.gateway: DEBUG
    org.springframework.cloud.gateway: DEBUG
    com.alibaba.cloud.nacos: DEBUG

# ==================== 健康检查配置 ====================
management:
  endpoints:
    web:
      exposure:
        include: health,gateway  # 暴露健康检查和网关端点
  endpoint:
    health:
      show-details: always
